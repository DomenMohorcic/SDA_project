---
title: "Statistics and Data Analysis Assignment"
author: "Domen Mohorčič, Larsen Cundrič"
date: "09/04/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(ggplot2)
library(psych)
library(lawstat)
```

# Roller Coaster Dataset Analysis

State hypothesis here...


## Basic analysis and plots

```{r, echo=FALSE}
roller_coasters_raw <- readr::read_csv('datasets/roller_coasters.csv')
```


```{r}
# GForce to many missing values..
# 
summary(roller_coasters_raw)
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Country, y = Speed, fill = Country))
```
```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = City, y = Speed))
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Park, y = Speed))
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Construction, y = Speed, fill = Construction))
```

```{r}
# Type is same as Construction?
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Type, y = Speed))
```

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_point(aes(x = Height, y = Speed, color = Construction))
```

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_point(aes(x = Length, y = Speed, color = Construction))
```

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_boxplot(aes(x = as.factor(Numinversions), y = Speed, color = Construction))
```

```{r}
# dost lame ... lahko spustimo
roller_coasters_raw %>% 
  filter(!is.na(GForce)) %>% 
  ggplot() +
    geom_point(aes(x = GForce, y = Speed))
```

## Inference and Hypothesis testing

### Hypothesis Testing

0) Check CLT conditions
Central limit theorem:
- Samples are independent,  
- Sample size is bigger or equal to 30,
- Population distribution is not strongly skewed.

1) Set-up the hypothesis

2) Assume threshold values
- $\alpha - significance level$ - typically 0.05

3) Calculate the Results:
- point est.
- number of cases
- sd - standard deviation
- se - standard error
- df - degrees of freedom $df = n-1$
- t-statistics
- p-value

4) Draw conclusions - Accept or reject hypothesis


If we meet those criteria, we can infer about the population based on the analysis we do on the sample
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Speed))
```
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Length))
```
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Height))
```

```{r}
(symmetry.test(roller_coasters_raw$Speed))
(shapiro.test(roller_coasters_raw$Speed))

(symmetry.test(roller_coasters_raw$Height))
(shapiro.test(roller_coasters_raw$Height))

(symmetry.test(roller_coasters_raw$Length))
(shapiro.test(roller_coasters_raw$Length))
```

We are allowed to infere on Speed, since only Speed meets the Limit Theorem requirements...
```{r}
roller_coasters_speeds <- roller_coasters_raw %>% 
  select(Speed) %>% 
  filter(!is.na(Speed)) 
roller_coasters_speeds
```

$H_0:$ population mean speed is 70mph $\mu = 70$
$H_A:$ population mean speed is not 70mph $\mu \neq 70$


We want to infere on the Speed of roller coasters...
```{r}
(point_est_speed <- 70)
(mean_speed <- mean(roller_coasters_speeds$Speed))
(sd_speed <- sd(roller_coasters_speeds$Speed)) # standard deviation
(sem_speed <- sd_speed / nrow(roller_coasters_speeds)) # standard error
(df_speed <- nrow(roller_coasters_speeds) - 1)
(t_speed <- (point_est_speed-mean_speed) / sem_speed)
```
p-value
```{r}
(p_val <- 2*(1- pt(t_speed, df = df_speed)))
```

95% confidence intervals
```{r}
#lower limit
# mean_speed - 1.96 * sem_speed
mean_speed + qt(0.025, df = df_speed) * sem_speed
#upper limit
# mean_speed + 1.96 * sem_speed
mean_speed + qt(0.975, df = df_speed) * sem_speed
```


Let's plot our discovery...
```{r}
xframe <- seq(-7, 7, length = 100)
ggplot(data.frame(x = xframe), aes(x = x)) +
  stat_function(fun = dt, args = list(df = df_speed)) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = dt(0, df = df_speed)),
               color = 'blue',
               linetype = 'dashed') + 
  geom_segment(aes(x = t_speed, y = 0, xend = t_speed, yend = 0.4),
               color = 'red')
```

We reject the null hypothesis in favor of the alternative.
Mean roller coaster speed is not 70mph!

## Correlation Analysis

```{r}
# precej zanimivi so Height, Length, Numinversions
(cor.test(roller_coasters_raw$Height, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Length, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Numinversions, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Duration, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$GForce, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Opened, roller_coasters_raw$Speed)) # not good
```

```{r}
#pairs(roller_coasters, lower.panel = NULL)
```

## Regression

```{r}
roller_coasters <- roller_coasters_raw %>% 
  select(Construction, Length, Height, Speed) %>% 
  filter(!is.na(Speed) & !is.na(Height) & !is.na(Length)) %>% 
  mutate("Steel" = as.numeric(Construction == 'Steel')) %>% 
  select(-Construction)
roller_coasters
```

```{r}
## 75% of the sample size
smp_size <- floor(0.75 * nrow(roller_coasters))

## set the seed to make your partition reproducible
set.seed(123)
train_ind <- sample(seq_len(nrow(roller_coasters)), size = smp_size)

(train <- roller_coasters[train_ind, ])
(test <- roller_coasters[-train_ind, ])
```


```{r}
lin_model <- lm(Speed ~ ., data = train)
(summary(lin_model))
(coef(lin_model))
```

```{r}
rc_all <- lm(Speed ~ ., data = roller_coasters)
(summary(rc_all))
plot(rc_all)
```

```{r}
roller_coasters %>% ggplot()+
  geom_point(aes(x = Height, y = Speed))+
  geom_smooth(aes(x = Height, y = Speed), method = lm)
```

```{r}
roller_coasters$log_height <- log(roller_coasters$Height)
roller_coasters$sq_height <- sqrt(roller_coasters$Height)

rc_all <- lm(Speed ~ sq_height, data = roller_coasters)
(summary(rc_all))
plot(rc_all)
```


# Red billed seagulls

The dataset is available here: https://grapher.jake4maths.com/?folder=sneddon&dataset=GULLS.csv

```{r}
seagulls <- read.csv("datasets/seagulls.csv")
seagulls[seagulls$LOCATION == "MURWAI",]$LOCATION <- "MURIWAI"
```

```{r}
seagulls %>% ggplot()+
  geom_boxplot(aes(x = LOCATION, y = WEIGHT, fill = SEX))
```

```{r}
seagulls %>% ggplot()+
  geom_boxplot(aes(x = SEASON, y = WEIGHT, fill = SEX))
```

```{r}
seagulls %>% ggplot()+
  geom_density(aes(x = WEIGHT, fill = SEX), alpha = 0.3)
```

```{r}
seagulls %>% ggplot()+
  geom_density(aes(x = WEIGHT, fill = SEASON), alpha = 0.3)
```

```{r}
seagulls %>% ggplot()+
  geom_density(aes(x = WEIGHT, fill = COAST), alpha = 0.3)
```

```{r}
seagulls %>% ggplot()+
  geom_point(aes(x = LENGTH, y = WEIGHT, color = SEX))
```

## Inference

Is weight of males different on east and west coast?
```{r}
sg_east <- seagulls %>% filter(COAST == "EAST", SEX == "MALE")
sg_west <- seagulls %>% filter(COAST == "WEST", SEX == "MALE")
```

Check CLT conditions:
1) Samples are made from independant observations ... OK
2) Sample size is larger than 30 for both east and west males ... OK
```{r}
nrow(sg_east)
nrow(sg_west)
```
3) Population is not strongly skewed ... OK
```{r}
seagulls %>% filter(SEX == "MALE") %>% ggplot()+
  geom_density(aes(x = WEIGHT, fill = COAST), alpha = 0.3)
```

4) Groups are independant of each other ... OK
5) Both groups are normally distributed ... OK

```{r}
east.mean <- mean(sg_east$WEIGHT)
east.sd <- sd(sg_east$WEIGHT)
sg_east %>% ggplot()+
  geom_histogram(aes(x = WEIGHT, y = ..density..), fill = "green", color = "black")+
  stat_function(fun = dnorm, args = list(mean = east.mean, sd = east.sd))
```
```{r}
west.mean <- mean(sg_west$WEIGHT)
west.sd <- sd(sg_west$WEIGHT)
sg_west %>% ggplot()+
  geom_histogram(aes(x = WEIGHT, y = ..density..), fill = "orange", color = "black")+
  stat_function(fun = dnorm, args = list(mean = west.mean, sd = west.sd))
```

Setup hypothesis:

$H_0:$ Mean weight is the same in east and west coast $mean_{east} - mean_{west} = 0$
$H_A:$Mean weight is not the same in east and west coast $mean_{east} - mean_{west} \neq 0$

```{r}
(point_estimate <- east.mean - west.mean)
(SE <- sqrt(east.sd ^ 2 / nrow(sg_east) + west.sd ^ 2 / nrow(sg_west)))
(df <- min(nrow(sg_east) - 1, nrow(sg_west) - 1))
(t_score <- point_estimate / SE)
```

```{r}
ggplot(data.frame(x = seq(-6, 6, length = 200)), aes(x = x))+
  stat_function(fun = dt, args = list(df = df))+
  geom_segment(aes(x = t_score, y = 0, xend = t_score, yend = 0.4), color="red")
```

```{r}
(p_value <- 2 * pt(t_score, df))
```

We reject $H_0$ in favor of $H_A$. Seagulls on east and west coast do not weight
the same. Since our point estimate came out negative, we can say that seagulls
on west coast weight more than seagulls on east coast.