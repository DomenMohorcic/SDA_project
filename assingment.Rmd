---
title: "Statistics and Data Analysis Assignment"
author: "Domen Mohorčič, Larsen Cundrič"
date: "09/04/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(ggplot2)
library(psych)
library(lawstat)
```

# Roller Coaster Dataset Analysis

State hypothesis here...


## Basic analysis and plots

```{r, echo=FALSE}
roller_coasters_raw <- readr::read_csv('datasets/roller_coasters.csv')
```


```{r}
# GForce to many missing values..
# 
summary(roller_coasters_raw)
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Country, y = Speed))
```
```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = City, y = Speed))
```



```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Park, y = Speed))
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Construction, y = Speed))
```

```{r}
# Type is same as Construction?
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Type, y = Speed))
```


```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_point(aes(x = Height, y = Speed, color = Construction))
```


```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_point(aes(x = Length, y = Speed, color = Construction))
```

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_boxplot(aes(x = as.factor(Numinversions), y = Speed, color = Construction))
```

```{r}
# dost lame ... lahko spustimo
roller_coasters_raw %>% 
  filter(!is.na(GForce)) %>% 
  ggplot() +
    geom_point(aes(x = GForce, y = Speed))
```

## Inference and Hypothesis testing

### Hypothesis Testing

0) Check CLT conditions
Central limit theorem:
- Samples are independent,  
- Sample size is bigger or equal to 30,
- Population distribution is not strongly skewed.

1) Set-up the hypothesis

2) Assume threshold values 
* $ \alpha - significance level$ - typically 0.05

3) Calculate the Results:
* point est.
* number of cases
* sd - standard deviation
* se - standard error
* df - degrees of freedom $ df = n-1 $
* t-statistics
* p-value

4) Draw conclusions - Accept or reject hypothesis


If we meet those criteria, we can infer about the population based on the analysis we do on the sample
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Speed))
```
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Length))
```
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Height))
```

```{r}
(symmetry.test(roller_coasters_raw$Speed))
(shapiro.test(roller_coasters_raw$Speed))

(symmetry.test(roller_coasters_raw$Height))
(shapiro.test(roller_coasters_raw$Height))

(symmetry.test(roller_coasters_raw$Length))
(shapiro.test(roller_coasters_raw$Length))
```

We are allowed to infere on Speed, since only Speed meets the Limit Theorem requirements...
```{r}
roller_coasters_speeds <- roller_coasters_raw %>% 
  select(Speed) %>% 
  filter(!is.na(Speed)) 
roller_coasters_speeds
```

$H_0:$ population mean speed is 70mph $\mu = 70$
$H_A:$ population mean speed is not 70mph $\mu \neq 70$


We want to infere on the Speed of roller coasters...
```{r}
(point_est_speed <- 70)
(mean_speed <- mean(roller_coasters_speeds$Speed))
(sd_speed <- sd(roller_coasters_speeds$Speed)) # standard deviation
(sem_speed <- sd_speed / nrow(roller_coasters_speeds)) # standard error
(df_speed <- nrow(roller_coasters_speeds) - 1)
(t_speed <- (point_est_speed-mean_speed) / sem_speed)
```
p-value
```{r}
(p_val <- 2*(1- pt(t_speed, df = df_speed)))
```

95% confidence intervals
```{r}
#lower limit
# mean_speed - 1.96 * sem_speed
mean_speed + qt(0.025, df = df_speed) * sem_speed
#upper limit
# mean_speed + 1.96 * sem_speed
mean_speed + qt(0.975, df = df_speed) * sem_speed
```


Let's plot our discovery...
```{r}
xframe <- seq(-7, 7, length = 100) 
ggplot(data.frame(x = xframe), aes(x = x)) +
  stat_function(fun = dt, args = list(df = df_speed)) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = dt(0, df = df_speed)),
               color = 'blue',
               linetype = 'dashed') + 
  geom_segment(aes(x = t_speed, y = 0, xend = t_speed, yend = 0.4),
               color = 'red')
```


We accept the null hypothesis in favor of the alternative.
Mean roller coaster speed is not 70mph!


## Correlation Analysis

```{r}
# precej zanimivi so Height, Length, Numinversions
(cor.test(roller_coasters_raw$Height, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Length, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Numinversions, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Duration, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$GForce, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Opened, roller_coasters_raw$Speed)) # not good
```

## Regression

```{r}
roller_coasters <- roller_coasters_raw %>% 
  select(Construction, Length, Height, Speed) %>% 
  filter(!is.na(Speed) & !is.na(Height) & !is.na(Length)) %>% 
  mutate("Steel" = as.numeric(Construction == 'Steel')) %>% 
  select(-Construction)
roller_coasters
```

```{r}
## 75% of the sample size
smp_size <- floor(0.75 * nrow(roller_coasters))

## set the seed to make your partition reproducible
set.seed(123)
train_ind <- sample(seq_len(nrow(roller_coasters)), size = smp_size)

(train <- roller_coasters[train_ind, ])
(test <- roller_coasters[-train_ind, ])
```


```{r}
lin_model <- lm(Speed ~ ., data = train)
(summary(lin_model))
(coef(lin_model))
```


# Steam store games dataset analysis

For our second dataset...

```{r}
steam <- read.csv("datasets/steam.csv")
```

```{r}
steam_db <- steam %>% 
  filter(grepl("Single-player", categories), grepl("Indie", genres)) %>% 
  select(appid, name, release_date, positive_ratings, negative_ratings, average_playtime, median_playtime, owners, price)
steam_db$owners_category <- as.numeric(mapvalues(steam_db$owners,
                      from = c("0-20000","20000-50000","50000-100000","100000-200000","200000-500000","500000-1000000","1000000-2000000","2000000-5000000","5000000-10000000","10000000-20000000","20000000-50000000"),
                      to = 1:length(unique(steam_db$owners))))
steam_db <- steam_db %>% filter(owners_category >= 7)
```

## Description

## Summary statistics

Positive ratings
```{r}
(positive.sd = sd(steam_db$positive_ratings))
(positive.mean = mean(steam_db$positive_ratings))
(negative.sd = sd(steam_db$negative_ratings))
(negative.mean = mean(steam_db$negative_ratings))

steam_db %>% ggplot()+
  geom_density(mapping = aes(x = positive_ratings), color = "blue")+
  geom_density(aes(x = negative_ratings), color = "red")
```


## Inference
