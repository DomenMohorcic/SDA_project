---
title: "Statistics and Data Analysis Assignment"
author: "Domen Mohorčič, Larsen Cundrič"
date: "09/04/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(ggplot2)
library(lawstat)
library(e1071)
```

# INTRODUCTION

Our goal was to...


# ROLLER COASTERS DATASET

This dataset cointains...


## Summary Statistics and plots

```{r, echo=FALSE}
roller_coasters_raw <- readr::read_csv('datasets/roller_coasters.csv')
```


```{r}
# GForce to many missing values..
# 
summary(roller_coasters_raw)
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Country, y = Speed, fill = Country))
```
```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = City, y = Speed))
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Park, y = Speed))
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Construction, y = Speed, fill = Construction))
```

```{r}
# Type is same as Construction?
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Type, y = Speed))
```

```{r}
ggplot(data = roller_coasters_raw) +
  geom_boxplot(mapping = aes(x = Inversions, y = Speed))
```


## Inference and Hypothesis testing

0) Check CLT conditions
Central limit theorem:
- Samples are independent,  
- Sample size is bigger or equal to 30,
- Population distribution is not strongly skewed.

1) Set-up the hypothesis

2) Assume threshold values
- $\alpha - significance level$ - typically 0.05

3) Calculate the Results:
- point est.
- number of cases
- sd - standard deviation
- se - standard error
- df - degrees of freedom $df = n-1$
- t-statistics
- p-value

4) Draw conclusions - Accept or reject hypothesis


If we meet those criteria, we can infer about the population based on the analysis we do on the sample
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Speed))
```
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Length))
```
```{r}
ggplot(roller_coasters_raw) +
  geom_histogram(aes(x = Height))
```

```{r}
(symmetry.test(roller_coasters_raw$Speed))
(shapiro.test(roller_coasters_raw$Speed))

(symmetry.test(roller_coasters_raw$Height))
(shapiro.test(roller_coasters_raw$Height))

(symmetry.test(roller_coasters_raw$Length))
(shapiro.test(roller_coasters_raw$Length))
```

We are allowed to infere on Speed, since only Speed meets the Limit Theorem requirements...
```{r}
roller_coasters_speeds <- roller_coasters_raw %>% 
  select(Speed) %>% 
  filter(!is.na(Speed)) 
roller_coasters_speeds
```

### Hypothesis 1 - One sample t-test


Our hypothesis 1:

$H_0:$ population mean speed is 70mph $\mu = 70$
$H_A:$ population mean speed is not 70mph $\mu \neq 70$

We want to infere on the Speed of roller coasters...
```{r}
(point_est_speed <- 70)
(mean_speed <- mean(roller_coasters_speeds$Speed))
(sd_speed <- sd(roller_coasters_speeds$Speed)) # standard deviation
(sem_speed <- sd_speed / nrow(roller_coasters_speeds)) # standard error
(df_speed <- nrow(roller_coasters_speeds) - 1)
(t_speed <- (point_est_speed-mean_speed) / sem_speed)
```
p-value
```{r}
(p_val <- 2*(1- pt(t_speed, df = df_speed)))
```

95% confidence intervals
```{r}
#lower limit
# mean_speed - 1.96 * sem_speed
mean_speed + qt(0.025, df = df_speed) * sem_speed
#upper limit
# mean_speed + 1.96 * sem_speed
mean_speed + qt(0.975, df = df_speed) * sem_speed
```


Let's plot our discovery...
```{r}
xframe <- seq(-7, 7, length = 100)
ggplot(data.frame(x = xframe), aes(x = x)) +
  stat_function(fun = dt, args = list(df = df_speed)) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = dt(0, df = df_speed)),
               color = 'blue',
               linetype = 'dashed') + 
  geom_segment(aes(x = t_speed, y = 0, xend = t_speed, yend = 0.4),
               color = 'red')
```

We reject the null hypothesis in favor of the alternative.
Mean roller coaster speed is not 70mph!


### Hypothesis 2 - Difference of two means t-test

We want to check if the Wooden roller coasters are on average faster that the Steel ones.

```{r}
roller_coasters_steel <- roller_coasters_raw %>% 
  filter(Construction == "Steel" & !is.na(Speed))

roller_coasters_wood <- roller_coasters_raw %>% 
  filter(Construction == "Wood" & !is.na(Speed))
```

Check number of instances
```{r}
nrow(roller_coasters_steel)
nrow(roller_coasters_wood)
```
```{r}
ggplot(roller_coasters_steel) +
  geom_histogram(aes(x = Speed, y = ..density..), fill ='red') +
  stat_function(fun = dnorm, args = list(mean = mean(roller_coasters_steel$Speed), sd = sd(roller_coasters_steel$Speed)))
```
```{r}
ggplot(roller_coasters_wood) +
  geom_histogram(aes(x = Speed, y = ..density..), fill ='red') +
  stat_function(fun = dnorm, args = list(mean = mean(roller_coasters_wood$Speed), sd = sd(roller_coasters_wood$Speed)))
```

Our hypothesis 2:
$$ H_O: mean_{Wood} - mean_{Steel}  = 0 $$
$$ H_A: mean_{Wood} - mean_{Steel} \neq 0 $$

$$ \alpha = 0.05 $$ 


```{r}
(point_est_const <- mean(roller_coasters_wood$Speed) - mean(roller_coasters_steel$Speed))
# (sample_sd <- sd(kiwi_gs_m$height_cm))
(SE <- sqrt((sd(roller_coasters_wood$Speed)^2/nrow(roller_coasters_wood)) + sd(roller_coasters_steel$Speed)^2/nrow(roller_coasters_steel)))
(df <- nrow(roller_coasters_wood) - 1) # less
(t_stat_const <- (point_est_const - 0) / SE) # t-score!
```

```{r}
ggplot(data.frame(x = seq(-7, 7, length = 100)), aes(x = x)) + 
  stat_function(fun = dt, args = list(df = df)) +
  geom_segment(aes(x = t_stat_const, y = 0, xend = t_stat_const, yend = 0.4), color = 'red')
```

```{r}
(p_val <- 2 * (1 - pt(t_stat_const, df)))
```

We reject the NULL hypothesis in favour of the alternative. The difference in means is significant
and wooden roller coasters go faster on average.


## Regression Analysis

### Correlation Analysis

```{r}
# precej zanimivi so Height, Length, Numinversions
(cor.test(roller_coasters_raw$Height, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Length, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Numinversions, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Duration, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$GForce, roller_coasters_raw$Speed))
(cor.test(roller_coasters_raw$Opened, roller_coasters_raw$Speed)) # not good
```

```{r}
#pairs(roller_coasters, lower.panel = NULL)
```
### Regressoin Plots

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_point(aes(x = Height, y = Speed, color = Construction))
```

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_point(aes(x = Length, y = Speed, color = Construction))
```

```{r}
roller_coasters_raw %>% 
  ggplot() +
    geom_boxplot(aes(x = as.factor(Numinversions), y = Speed, color = Construction))
```

```{r}
# dost lame ... lahko spustimo
roller_coasters_raw %>% 
  filter(!is.na(GForce)) %>% 
  ggplot() +
    geom_point(aes(x = GForce, y = Speed))
```


### Regression

```{r}
roller_coasters <- roller_coasters_raw %>% 
  select(Construction, Length, Height, Speed) %>% 
  filter(!is.na(Speed) & !is.na(Height) & !is.na(Length)) %>% 
  mutate("Steel" = as.numeric(Construction == 'Steel')) %>% 
  select(-Construction)
roller_coasters
```

```{r}
## 75% of the sample size
smp_size <- floor(0.75 * nrow(roller_coasters))

## set the seed to make your partition reproducible
set.seed(123)
train_ind <- sample(seq_len(nrow(roller_coasters)), size = smp_size)

(train <- roller_coasters[train_ind, ])
(test <- roller_coasters[-train_ind, ])
```


```{r}
lin_model <- lm(Speed ~ ., data = train)
(summary(lin_model))
(coef(lin_model))
```

```{r}
rc_all <- lm(Speed ~ ., data = roller_coasters)
(summary(rc_all))
plot(rc_all)
```

```{r}
roller_coasters %>% ggplot()+
  geom_point(aes(x = Height, y = Speed))+
  geom_smooth(aes(x = Height, y = Speed), method = lm)
```

```{r}
roller_coasters$log_height <- log(roller_coasters$Height)
roller_coasters$sq_height <- sqrt(roller_coasters$Height)

rc_all <- lm(Speed ~ sq_height, data = roller_coasters)
(summary(rc_all))
plot(rc_all)
```


# Red billed seagulls

The dataset seagulls.csv represents the data collected about seagulls in Auckland,
New Zeland. Dataset can be found [here](https://grapher.jake4maths.com/?folder=sneddon&dataset=GULLS.csv).

Data was collected on two seperate occasions (summer and winter) and on four
different locations: Muriwai (a), Piha (b), Mareatai (c), and Waitawa (d).

![Auckland region](seagulls.png)

They collected seagull's weight, length, and sex, as well as its
location and season. Authors of the dataset also point out that none of the
locations is a major breeding site.

We also cleaned dataset a bit. Some cases have misspelled "MURIWAI" as "MURWAI".
Variables location, coast, season, and sex have been converted from strings to
factors, and length was renamed to height, since that is more accurate varable
description.
```{r, warning=FALSE, error=FALSE}
seagulls <- read.csv("datasets/seagulls.csv")
seagulls[seagulls$LOCATION == "MURWAI",]$LOCATION <- "MURIWAI"
colnames(seagulls)[2] <- "HEIGHT"
seagulls$LOCATION <- as.factor(seagulls$LOCATION)
seagulls$COAST <- as.factor(seagulls$COAST)
seagulls$SEASON <- as.factor(seagulls$SEASON)
seagulls$SEX <- as.factor(seagulls$SEX)
```

## Summary statistics

Seagulls dataset has `r nrow(seagulls)` cases and 6 variables: weight, height,
location, coast, season, and sex. Weight and length are numerical, while location,
coast, season, and sex are categorical.
```{r summary_sg}
summary(seagulls)
```

Weight of seagulls is in grams (g), and its distribution can be seen here:
```{r sg_weightDistributionSex}
seagulls %>% ggplot()+
  geom_density(aes(x = WEIGHT, fill = SEX), alpha = 0.3)
```
Average weight of males is 278.73g with minimum of 235g and maximum of 320g.
Average weight of females is 262.49g with minimum of 212g and maximum of 302g.
We can see that weights of males are not normally distributed, while weights of
females could be. We can check this with normality test:
```{r sg_shapiroWeight}
shapiro.test(seagulls[seagulls$SEX == "MALE",]$WEIGHT)
shapiro.test(seagulls[seagulls$SEX == "FEMALE",]$WEIGHT)
```
We can see that weight is not normally distributed neither for males nor females,
but latter are very close to passing the normallity test. We can also check if
the distributions are at least symmetric:
```{r sg_symmetryWeight}
symmetry.test(seagulls[seagulls$SEX == "MALE",]$WEIGHT)
symmetry.test(seagulls[seagulls$SEX == "FEMALE",]$WEIGHT)
```
Both pass symmetry test, meaning they are not strongly skewed and can be used
later for inference.

Height of seagulls is in centimeters (cm):
```{r sg_heightDistributionSex}
seagulls %>% ggplot()+
  geom_density(aes(x = HEIGHT, fill = SEX), alpha = 0.3)
```
Average height of males is 37.74cm. Smallest male's height is 30cm, while largest
is 44.8cm. Female's average height is 36.5cm with minimum of 28.5cm and maximum
of 43.7cm.
Seagulls height seems more normally distributed than weight, but we can check:
```{r sg_shapiroHeight}
shapiro.test(seagulls[seagulls$SEX == "MALE",]$HEIGHT)
shapiro.test(seagulls[seagulls$SEX == "FEMALE",]$HEIGHT)
```
We can see that height for both sexes passes as normally distributed.

Location and coast are describing almost the same thing since coast is more broad
description of location (Maraetai and Waitawa are under east coast and Muriwai and
Piha are under west coast). Locations are almost equally represented in our dataset:
```{r sg_location}
summary(seagulls$LOCATION)
```
Coast variable is also equaly distributed:
```{r sg_coast}
summary(seagulls$COAST)
```

Season is either winter or summer. There are a little more entries for summer than
for winter, but the difference is miniscule:
```{r sg_season}
summary(seagulls$SEASON)
```

There are more females presented in our dataset but the difference can be ignored:
```{r sg_sex}
summary(seagulls$SEX)
```

We also drew some other plots representing how different variables are connected:
```{r}
seagulls %>% ggplot()+
  geom_boxplot(aes(x = LOCATION, y = WEIGHT, fill = SEX))
```
```{r}
seagulls %>% ggplot()+
  geom_boxplot(aes(x = SEASON, y = WEIGHT, fill = SEX))
```
```{r}
seagulls %>% ggplot()+
  geom_point(aes(x = HEIGHT, y = WEIGHT, color = SEX))
```

## Inference

Since we can divide our datasets in many ways, we can also check many differnet
hypothesis.

### Is weight of males same on east and west coast?

We first divide our dataset into two smaller ones, which represent males from
different coasts.
```{r sg_inferenceSplit}
sg_east <- seagulls %>% filter(COAST == "EAST", SEX == "MALE")
sg_west <- seagulls %>% filter(COAST == "WEST", SEX == "MALE")
```

Next we need to check CLT conditions. Since samples were collected independently
from one another, first condition is true. Next we need to check if both samples
have sufficient size. There are `r nrow(sg_east)` males from east and `r nrow(sg_west)`
males from west. Both samples are larger than 30, so second condition is also true.
Then we need to check if any of samples is skewed. We can draw their distributions
and see that they both are somewhat symmetrical.
```{r sg_inferencePlot}
seagulls %>% filter(SEX == "MALE") %>% ggplot()+
  geom_density(aes(x = WEIGHT, fill = COAST), alpha = 0.3)
```
We can also calculate skewness of both distributions. Weight of males from east
coast have skewness of `r skewness(sg_east$WEIGHT)` and males from west have
skewness of `r skewness(sg_west$WEIGHT)`. Both values are small, so we can safely
say that neither distribution is strongly skewed.

We also need to check wether cases from groups are independant from each other.
Since they were collected on different locations, they are independant.
We can check if both groups are normally distributed. For that we can draw
histogram of weights and overlay it with normal distribution with same average
and standard deviation:
```{r sg_inferenceEast, message=FALSE}
east.mean <- mean(sg_east$WEIGHT)
east.sd <- sd(sg_east$WEIGHT)
sg_east %>% ggplot()+
  geom_histogram(aes(x = WEIGHT, y = ..density..), fill = "green", color = "black")+
  stat_function(fun = dnorm, args = list(mean = east.mean, sd = east.sd))
```
```{r sg_inferenceWest, message=FALSE}
west.mean <- mean(sg_west$WEIGHT)
west.sd <- sd(sg_west$WEIGHT)
sg_west %>% ggplot()+
  geom_histogram(aes(x = WEIGHT, y = ..density..), fill = "orange", color = "black")+
  stat_function(fun = dnorm, args = list(mean = west.mean, sd = west.sd))
```
Neither distribution seem normally distributed. We can further test that hypothesis
with normallity test:
```{r sg_inferenceShapiro}
shapiro.test(sg_east$WEIGHT)
shapiro.test(sg_west$WEIGHT)
```
Neither group has normal distribution, but they are symmetrical, so we will continue
with our hypothesis testing.

Then we set-up the hypothesis:
$H_0:$ Mean weight is the same in east and west coast: $mean_{east} - mean_{west} = 0$
$H_A:$ Mean weight is not the same in east and west coast: $mean_{east} - mean_{west} \neq 0$
We set a threshold value $\alpha = 0.05$.

We calculate our point estimate, standard error, and t-score and plot it:
```{r sg_inferencePointEstimate}
point_estimate <- east.mean - west.mean
SE <- sqrt(east.sd ^ 2 / nrow(sg_east) + west.sd ^ 2 / nrow(sg_west))
df <- min(nrow(sg_east) - 1, nrow(sg_west) - 1)
t_score <- point_estimate / SE

ggplot(data.frame(x = seq(-6, 6, length = 200)), aes(x = x))+
  stat_function(fun = dt, args = list(df = df))+
  geom_segment(aes(x = t_score, y = 0, xend = t_score, yend = 0.4), color="red")
```
We can see that our t-score (red line) falls to the left of student's t-distribution,
so our null hypothesis is very likely false. We can further confirm that with our
p-value calculation:
```{r sg_inferencePValue}
p_value <- 2 * pt(t_score, df)
```
Since p-value is smaller than $\alpha$ (`r p_value` $< 0.05$), we reject $H_0$ in
favor of $H_A$. Seagulls on east and west coast do not weight the same. Because our
point estimate is negative, we can say that seagulls on west coast weight
more than seagulls on east coast.